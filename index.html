<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <link href='http://fonts.googleapis.com/css?family=Quicksand' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" />
  <title>Birthe Diget</title>
</head>
<body>
  <div id="st_main" class="st_main">
    <img class="st_preview" style="display: none" />
		<div class="st_overlay"></div>
		<h1>Birthe Diget</h1>
		<div id="st_loading" class="st_loading"><span>Loading...</span></div>
		<ul id="st_nav" class="st_navigation">
		  <li>
      	<span class="st_link">Kontakt<span class="st_arrow_down"></span></span>
				<div class="st_about st_thumbs_wrapper">
					<div class="st_subcontent">
						<p>
						 Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras ut mi ante, nec porta erat. Fusce malesuada libero ut dui elementum facilisis.
						</p>
						<p>
						  Pellentesque eros arcu, sodales in vehicula a, auctor quis justo. Nulla eget nisi congue ligula elementum commodo.
						</p>
					</div>
				</div>
			</li>
		</ul>
	</div>
	<div>
    <span class="reference">
      &copy; Copyright 2012 Birthe Diget. All rights reserved.
    </span>
  </div>
  <script type="text/javascript">
    $(function() {
			var $loader	= $('#st_loading'); 
			var $list	= $('#st_nav');
			var $currImage = $('#st_main').children('img:first');

			function buildThumbs(){
				$list.children('li.album').each(function(){
					var $elem = $(this);
					var $thumbs_wrapper = $elem.find('.st_thumbs_wrapper');
					var $thumbs = $thumbs_wrapper.children(':first');
					//each thumb has 180px and we add 3 of margin
					var finalW = $thumbs.find('img').length * 183;
					$thumbs.css('width',finalW + 'px');
					//make this element scrollable
					makeScrollable($thumbs_wrapper, $thumbs);
				});
			}
			
			//clicking on the menu items (up and down arrow)
			//makes the thumbs div appear, and hides the current 
			//opened menu (if any)
			$list.find('.st_arrow_down').live('click',function(){
				var $this = $(this);
				hideThumbs();
				$this.addClass('st_arrow_up').removeClass('st_arrow_down');
				var $elem = $this.closest('li');
				$elem.addClass('current').animate({'height':'170px'},200);
				var $thumbs_wrapper = $this.parent().next();
				$thumbs_wrapper.show(200);
			});
			$list.find('.st_arrow_up').live('click',function(){
				var $this = $(this);
				$this.addClass('st_arrow_down').removeClass('st_arrow_up');
				hideThumbs();
			});
			
			//function to hide the current opened menu
			function hideThumbs(){
				$list.find('li.current')
					 .animate({'height':'50px'},400,function(){
						$(this).removeClass('current');
					 })
					 .find('.st_thumbs_wrapper')
					 .hide(200)
					 .andSelf()
					 .find('.st_link span')
					 .addClass('st_arrow_down')
					 .removeClass('st_arrow_up');
			}

			//makes the thumbs div scrollable
			//on mouse move the div scrolls automatically
			function makeScrollable($outer, $inner){
				var extra = 0;
				//Get menu width
				var divWidth = $outer.width();
				//Remove scrollbars
				$outer.css({
					overflow: 'hidden'
				});
				//Find last image in container
				var lastElem = $inner.find('img:last');
				$outer.scrollLeft(0);
				//When user move mouse over menu
				$outer.unbind('mousemove').bind('mousemove',function(e){
					var containerWidth = lastElem[0].offsetLeft + lastElem.outerWidth() + 2*extra;
					var left = (e.pageX - $outer.offset().left) * (containerWidth-divWidth) / divWidth - extra;
					$outer.scrollLeft(left);
				});
			}
      
      var apiKey = '9b06d4beca98afbde33fa78b2875b837';
      var userId = '60399799@N00';
      var tag = '<COMMA SEPERATED LIST OF TAGS>';
      var perPage = '25';
      var showOnPage = '6';
      var url = 'http://api.flickr.com/services/rest/?format=json&method=flickr.photos.search&api_key=' + apiKey + '&user_id=' + userId + '&per_page=' + perPage + '&jsoncallback=?';
      $.getJSON(url, function(data) {
        var htmlString = '<li class="album"><span class="st_link">Galleri 1<span class="st_arrow_down"></span></span><div class="st_wrapper st_thumbs_wrapper"><div class="st_thumbs">';
        
        $.each(data.photos.photo, function(i, item){
          var baseUrl = 'http://farm' + item.farm + '.static.flickr.com/' + item.server + '/' + item.id + '_' + item.secret;
          var thumbPhotoURL = baseUrl + '_t.jpg';
          var mediumPhotoURL = baseUrl + '_m.jpg';
          var largePhotoURL = baseUrl + '_b.jpg';
          
          if (i == 0) {
            $currImage.attr('src', largePhotoURL);
          }
          
          htmlString += '<img src="' + thumbPhotoURL + '" alt="' + largePhotoURL + '" />';
        });
        
        htmlString += '</div></div></li>';
        $("#st_nav").append(htmlString);
        
        //calculates the width of the div element 
  			//where the thumbs are going to be displayed
  			buildThumbs();
  			
  			//show current image
  			$currImage.load(function() {
  			  $currImage.fadeIn(3000);
  			});
  			
  			
  			//slide out the menu
				setTimeout(function(){
					$list.animate({'left':'0px'}, 500);
				}, 500);
				
				//remove loader
				$loader.hide();
				
				//clicking on a thumb, replaces the large image
  			$list.find('.st_thumbs img').bind('click',function(){
  				var $this = $(this);
  				$loader.show();
  				$('<img class="st_preview"/>').load(function(){
  					var $this = $(this);
  					var $currImage = $('#st_main').children('img:first');
  					$this.insertBefore($currImage);
  					$loader.hide();
  					$currImage.fadeOut(2000,function(){
  						$(this).remove();
  					});
  				}).attr('src',$this.attr('alt'));
  			}).bind('mouseenter',function(){
  				$(this).stop().animate({'opacity':'1'});
  			}).bind('mouseleave',function(){
  				$(this).stop().animate({'opacity':'0.7'});
  			});
      });
    });
  </script>
</body>
</html>